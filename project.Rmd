---
title: Analiza skupa podataka o kretanju taksi vozila u Njujorku u januaru 2015. godine
author: Luka Ćirić
output: html_document
---

### Luka Ćirić, E2 18/2023
# Specifikacija
Specifikacija na [linku](http://www.acs.uns.ac.rs/sr/filebrowser/download/11975528)

# Opis skupa podataka
Skup podataka je javno dostupan za preuzimanje na [linku](https://www.nyc.gov/site/tlc/about/tlc-trip-record-data.page). 
Podaci originalno preuzeti u **PARQUET** formatu, a zatim konvertovani u **CSV** format.
Skup podataka se sastoji od podataka o kretanju taksi vozila i zaradi u Njujorku u januaru 2015. godine.

## Opis atributa
Skup podataka se sastoji od atributa:<br/>
1. **VendorID** - identifikator provajdera usluge taksi prevoza<br/>
2. **tpep_pickup_datetime** - datum i vreme preuzimanja putnika<br/>
3. **tpep_dropoff_datetime** - datum i vreme iskrcavanja putnika<br/>
4. **passenger_count** - broj putnika<br/>
5. **trip_distance** - dužina putovanja u miljama<br/>
6. **RatecodeID** - identifikator tarifnog koda<br/>
7. **store_and_fwd_flag** - indikator da li je vožnja prvo sačuvana u memoriji pre slanja<br/>
8. **PULocationID** - identifikator lokacije preuzimanja putnika<br/>
9. **DOLocationID** - identifikator lokacije iskrcavanja putnika<br/>
10. **payment_type** - način plaćanja<br/>
12. **fare_amount** - cena vožnje<br/>
13. **extra** - dodatni troškovi<br/>
14. **mta_tax** - troškovi MTA<br/>
15. **tip_amount** - napojnica (popunjena samo za plaćanje karticom)<br/>
16. **tolls_amount** - troškovi putarine<br/>
17. **improvement_surcharge** - troškovi poboljšanja<br/>
18. **total_amount** - ukupna cena<br/>
19. **congestion_surcharge** - troškovi gužve<br/>
20. **airport_fee** - troškovi aerodroma<br/>

Specifikacija obeležja dostupna na [linku](https://www.nyc.gov/assets/tlc/downloads/pdf/data_dictionary_trip_records_yellow.pdf)

## Kod za prevođenje podataka u CSV format (Python):
```python
import pandas as pd

def parquet_to_csv(parquet_file_path, csv_file_path):
    # Read the Parquet file into a DataFrame
    df = pd.read_parquet(parquet_file_path)
    
    # Write the DataFrame to a CSV file
    df.to_csv(csv_file_path, index=False)

if __name__ == "__main__":
    # Replace these with your actual file paths
    parquet_file_path = input("Enter input file: ") + ".parquet"
    csv_file_path = input("Enter output file: ") + ".csv"
    
    parquet_to_csv(parquet_file_path, csv_file_path)
    
```
# Implementacija
## Instalacija
### Instalacija paketa
```{r Instalacija paketa, results='hide', message=FALSE, warning=FALSE, error=FALSE}
install.packages("tidyverse")
install.packages("sparklyr")
install.packages("rmarkdown")
install.packages("knitr")
install.packages("pandoc")
install.packages("dbplot")
```
### Učitavanje paketa
```{r Učitavanje paketa, results='hide', message=FALSE, warning=FALSE, error=FALSE}
library(sparklyr)
library(dplyr)
library(knitr)
library(rmarkdown)
library(ggplot2)
library(dbplot)
library(pandoc)
spark_install()
knitr::opts_knit$set(root.dir = file.path(getwd()))
```
### Podešavanje Spark sesije
```{r Podešavanje Spark sesije i knitr, results='hide', message=FALSE, warning=FALSE, error=FALSE}
conf <- spark_config()
conf["spark.executor.memory"] <- "6G"
conf["sparklyr.shell.driver-memory"] <- "6G"
sc <- spark_connect(master = "local", config = conf)
```
## Podaci
### Učitavanje skupa podataka
```{r Učitavanje skupa podataka, results='hide', message=FALSE, warning=FALSE, error=FALSE}
ds.path <- "~/FAX/RVPUII/projekat/data"
ds.df <- spark_read_csv(sc, name = "my_data", path = ds.path, header = TRUE, infer_schema = TRUE, memory = TRUE)
```
### Filtriranje skupa podataka
```{r Filtriranje skupa podataka, results='hide', message=FALSE, warning=FALSE, error=FALSE}
ds.filtered <- ds.df %>% 
    select(passenger_count, trip_distance, payment_type, fare_amount, tip_amount, tolls_amount, total_amount) %>%
    filter(
      !(is.na(passenger_count) || is.na(trip_distance) || is.na(payment_type) || 
        is.na(fare_amount) || is.na(total_amount) || is.na(tip_amount) || is.na(tolls_amount))
    ) %>%
    filter(
        trip_distance >= 0 && trip_distance <= 200 && 
        fare_amount >= 0 && fare_amount <= 1000 &&
        tip_amount >= 0 && tip_amount <= 200 &&
        tolls_amount >= 0 && tolls_amount <= 200 && 
        total_amount >= 0 && total_amount <= 1000 &&
        payment_type >= 1 && payment_type <= 6 &&
        passenger_count >= 1 && passenger_count <= 8
    )
```

### Dodavanje novih atributa
```{r Dodavanje novih atributa, results='hide', message=FALSE, warning=FALSE, error=FALSE}
data <- ds.filtered %>% 
    mutate(tip_status = cut(
        tip_amount,
        breaks = c(0, 1, 5, 10, Inf),
        labels = c("NONE", "LOW", "MID", "HIGH"),
        right = FALSE
    ))
```
### Funkcija za čišćenje memorije
```{r Funkcija za čišćenje memorije, results='hide', message=FALSE, warning=FALSE, error=FALSE}
clearFn <- function() {
    all_objects <- ls()
    needed_to_keep <- c("sc", "ds.df", "ds.filtered", "data", "conf", "clearFn")
    to_remove <- setdiff(all_objects, needed_to_keep)
    rm(list = to_remove)
}
```
## Analiza pojedinačnih atributa
### Analiza atributa passenger_count
```{r Analiza atributa passenger_count, message=FALSE, warning=FALSE, error=FALSE}
passengerCountCounts <- data %>%
    group_by(passenger_count) %>% 
    summarise(count = n()) %>% 
    collect() %>% arrange(passenger_count)

kable(passengerCountCounts)
```
```{r Vizuelizacija atributa passenger_count, include=FALSE, eval=FALSE, message=FALSE, warning=FALSE, error=FALSE}
passengerCounts <- pull(data, passenger_count)

png("images/passengerCountHistogram.png", width = 800, height = 1200)
xgran <- pretty(passengerCounts, n = 10)
xlabel <- seq(1, 8, 1)
hst <- hist(passengerCounts, main = "Broj vožnji po broju putnika", xlab = "Broj putnika", ylab = "Broj vožnji")
axis(1, at = xlabel, labels = xlabel)
ygran <- pretty(hst$counts, n = 10)
ylabel <- replace(ygran, ygran %% 1000000 != 0, NA)
axis(2, at = ygran, labels = ylabel)
dev.off()
clearFn()
```
![Broj vožnji po broju putnika](images/passengerCountHistogram.png)
### Analiza atributa trip_distance
```{r Analiza atributa trip_distance, message=FALSE, warning=FALSE, error=FALSE}
tripDistanceCounts <- data %>%
    summarise(min = min(trip_distance), max = max(trip_distance), avg = mean(trip_distance), median = median(trip_distance)) %>%
    collect()

kable(tripDistanceCounts)
```
```{r Vizuelizacija atributa trip_distance, include=FALSE, eval=FALSE, message=FALSE, warning=FALSE, error=FALSE}
tripDistances <- pull(data, trip_distance)
png("images/tripDistanceDensity.png", width = 800, height = 1200)
plt <- plot(density(tripDistances), main = "Distribucija atributa trip_distance", xlab = "Dužina putovanja", ylab = "Gustina")
dev.off()
clearFn()
```
![Distribucija atributa trip_distance](images/tripDistanceDensity.png)
### Analiza atributa payment_type
```{r Analiza atributa payment_type, message=FALSE, warning=FALSE, error=FALSE}
paymentTypeCounts <- data %>%
    group_by(payment_type) %>% 
    summarise(count = n()) %>% 
    collect() %>% arrange(payment_type)

kable(paymentTypeCounts)
```
```{r Vizuelizacija atributa payment_type, include=FALSE, eval=FALSE, message=FALSE, warning=FALSE, error=FALSE}
bar <- ggplot(paymentTypeCounts, aes(x = payment_type, y = count, fill = payment_type)) +
    geom_bar(stat = "identity") +
    labs(title = "Broj vožnji po payment_type-u", x = "payment_type", y = "Broj vožnji") +
    scale_y_continuous(breaks = seq(0, 20000000, 1000000)) +
    scale_x_continuous(breaks = seq(1, 6, 1), limits = c(0, 6))

ggsave("images/paymentTypeCounts.png", bar)
clearFn()
```
![Broj vožnji po payment_type-u](images/paymentTypeCounts.png)
### Analiza atributa fare_amount
```{r Analiza atributa fare_amount, message=FALSE, warning=FALSE, error=FALSE}
fareAmountCounts <- data %>%
    summarise(min = min(fare_amount), max = max(fare_amount), avg = mean(fare_amount), median = median(fare_amount)) %>%
    collect()


kable(fareAmountCounts)
```
```{r Vizuelizacija atributa fare_amount, include=FALSE, eval=FALSE, message=FALSE, warning=FALSE, error=FALSE}
fareAmounts <- pull(data, fare_amount)
png("images/fareAmountDensity.png", width = 800, height = 1200)

plt <- plot(density(fareAmounts), main = "Distribucija atributa fare_amount", xlab = "Cena vožnje", ylab = "Gustina", xlim = c(0, 100))

dev.off()
clearFn()
```
![Distribucija atributa fare_amount](images/fareAmountDensity.png)
### Analiza atributa tip_amount
```{r Analiza atributa tip_amount, message=FALSE, warning=FALSE, error=FALSE}
tipAmountCounts <- data %>%
    summarise(min = min(tip_amount), max = max(tip_amount), avg = mean(tip_amount), median = median(tip_amount)) %>%
    collect()


kable(tipAmountCounts)
```
```{r Vizuelizacija atributa tip_amount, include=FALSE, eval=FALSE, message=FALSE, warning=FALSE, error=FALSE}
tipAmounts <- pull(data, tip_amount)
png("images/tipAmountDensity.png", width = 800, height = 1200)
plt <- plot(density(tipAmounts), main = "Distribucija atributa tip_amount", xlab = "Napojnica", ylab = "Gustina", xlim = c(0, 20))
dev.off()
clearFn()
```
![Distribucija atributa tip_amount](images/tipAmountDensity.png)
### Analiza atributa tolls_amount
```{r Analiza atributa tolls_amount, message=FALSE, warning=FALSE, error=FALSE}
tollsAmountCounts <- data %>%
    summarise(min = min(tolls_amount), max = max(tolls_amount), avg = mean(tolls_amount), median = median(tolls_amount)) %>%
    collect()


kable(tollsAmountCounts)
```
```{r Vizuelizacija atributa tolls_amount, include=FALSE, eval=FALSE, message=FALSE, warning=FALSE, error=FALSE}
tollsAmounts <- pull(data, tolls_amount)
png("images/tollsAmountDensity.png", width = 800, height = 1200)
plt <- plot(density(tollsAmounts), main = "Distribucija atributa tolls_amount", xlab = "Troškovi putarine", ylab = "Gustina",  xlim = c(0, 20))
dev.off()
clearFn()
```
![Distribucija atributa tolls_amount](images/tollsAmountDensity.png)
### Analiza atributa total_amount
```{r Analiza atributa total_amount, message=FALSE, warning=FALSE, error=FALSE}
totalAmountCounts <- data %>%
    summarise(min = min(total_amount), max = max(total_amount), avg = mean(total_amount), median = median(total_amount)) %>%
    collect()

kable(totalAmountCounts)
```
```{r Vizuelizacija atributa total_amount, include=FALSE, eval=FALSE, message=FALSE, warning=FALSE, error=FALSE}
totalAmount <- pull(data, total_amount)
png("images/totalAmountDensity.png", width = 800, height = 1200)
plt <- plot(density(totalAmount), main = "Distribucija atributa total_amount", xlab = "Ukupna cena", ylab = "Gustina", xlim = c(0, 300))
dev.off()
clearFn()
```
![Distribucija atributa total_amount](images/totalAmountDensity.png)

### Analiza atributa tip_status
```{r Analiza atributa tip_status, message=FALSE, warning=FALSE, error=FALSE}
tipStatusCounts <- data %>%
    group_by(tip_status) %>%
    summarise(count = n()) %>%
    collect()

kable(tipStatusCounts)
```
```{r Vizuelizacija atributa tip_status, include=FALSE, eval=FALSE, message=FALSE, warning=FALSE, error=FALSE}
py <- pull(data, tip_status)
png("images/tipStatusCounts.png", width = 800, height = 1200)
pi <- pie(table(py), main = "Broj vožnji po načinu plaćanja")
dev.off()
clearFn()
```
![Broj vožnji po načinu plaćanja](images/tipStatusCounts.png)

## Analiza zavisnosti atributa
### Analiza zavisnosti atributa passenger_count i trip_distance
```{r Analiza zavisnosti atributa passenger_count i trip_distance, message=FALSE, warning=FALSE, error=FALSE}
passengerCountTripDistance <- data %>%
    group_by(passenger_count) %>%
    summarise(min = min(trip_distance), max = max(trip_distance), avg = mean(trip_distance), median = median(trip_distance)) %>%
    collect()

kable(passengerCountTripDistance)
```
```{r Vizuelizacija zavisnosti atributa passenger_count i trip_distance, include=FALSE, eval=FALSE, message=FALSE, warning=FALSE, error=FALSE}
ptd <- data %>%
    select(passenger_count, trip_distance) %>%
    collect()

png("images/passengerCountTripDistance.png", width = 800, height = 1200)
boxplot(trip_distance ~ passenger_count, data = ptd, main = "Dužina putovanja po broju putnika", xlab = "Broj putnika", ylab = "Dužina putovanja")
dev.off()
clearFn()
```
![Dužina putovanja po broju putnika](images/passengerCountTripDistance.png)

### Analiza zavisnosti atributa passenger_count i payment_type
```{r Analiza zavisnosti atributa passenger_count i payment_type, message=FALSE, warning=FALSE, error=FALSE}
passengerCountPaymentType <- data %>%
    group_by(passenger_count, payment_type) %>%
    summarise(count = n()) %>%
    collect() %>% arrange(passenger_count, payment_type)

kable(passengerCountPaymentType)
```
```{r Vizuelizacija zavisnosti atributa passenger_count i payment_type, include=FALSE, eval=FALSE, message=FALSE, warning=FALSE, error=FALSE}
ppt <- data %>%
    select(passenger_count, payment_type) %>%
    collect()

png("images/passengerCountPaymentType.png", width = 800, height = 1200)
mosaicplot(table(ppt), main = "Broj vožnji po broju putnika i payment_type-u", xlab = "Broj putnika", ylab = "payment_type", color = c("red", "blue", "green", "yellow", "purple", "orange"))
dev.off()
clearFn()
```
![Broj vožnji po broju putnika i payment_type-u](images/passengerCountPaymentType.png)

### Analiza zavisnosti atributa passenger_count i fare_amount
```{r Analiza zavisnosti atributa passenger_count i fare_amount, message=FALSE, warning=FALSE, error=FALSE}
passengerCountFareAmount <- data %>%
    group_by(passenger_count) %>%
    summarise(min = min(fare_amount), max = max(fare_amount), avg = mean(fare_amount), median = median(fare_amount)) %>%
    collect()

kable(passengerCountFareAmount)
```
```{r Vizuelizacija zavisnosti atributa passenger_count i fare_amount, include=FALSE, eval=FALSE, message=FALSE, warning=FALSE, error=FALSE}
pfa <- data %>%
    select(passenger_count, fare_amount) %>%
    collect()

png("images/passengerCountFareAmount.png", width = 800, height = 1200)
boxplot(fare_amount ~ passenger_count, data = pfa, main = "Cena vožnje po broju putnika", xlab = "Broj putnika", ylab = "Cena vožnje")
dev.off()
clearFn()
```

### Analiza zavisnosti atributa passenger_count i tip_amount
```{r Analiza zavisnosti atributa passenger_count i tip_amount, message=FALSE, warning=FALSE, error=FALSE}
passengerCountTipAmount <- data %>%
    group_by(passenger_count) %>%
    summarise(min = min(tip_amount), max = max(tip_amount), avg = mean(tip_amount), median = median(tip_amount)) %>%
    collect()
    
kable(passengerCountTipAmount)
```
```{r Vizuelizacija zavisnosti atributa passenger_count i tip_amount, include=FALSE, eval=FALSE, message=FALSE, warning=FALSE, error=FALSE}
pta <- data %>%
    select(passenger_count, tip_amount) %>%
    collect()

png("images/passengerCountTipAmount.png", width = 800, height = 1200)
boxplot(tip_amount ~ passenger_count, data = pta, main = "Napojnica po broju putnika", xlab = "Broj putnika", ylab = "Napojnica")
dev.off()
clearFn()
```
![Napojnica po broju putnika](images/passengerCountTipAmount.png)

### Analiza zavisnosti atributa passenger_count i tolls_amount
```{r Analiza zavisnosti atributa passenger_count i tolls_amount, message=FALSE, warning=FALSE, error=FALSE}
passengerCountTollsAmount <- data %>%
    group_by(passenger_count) %>%
    summarise(min = min(tolls_amount), max = max(tolls_amount), avg = mean(tolls_amount), median = median(tolls_amount)) %>%
    collect()

kable(passengerCountTollsAmount)
```
```{r Vizuelizacija zavisnosti atributa passenger_count i tolls_amount, include=FALSE, eval=FALSE, message=FALSE, warning=FALSE, error=FALSE}
pta <- data %>%
    select(passenger_count, tolls_amount) %>%
    collect()

png("images/passengerCountTollsAmount.png", width = 800, height = 1200)
boxplot(tolls_amount ~ passenger_count, data = pta, main = "Troškovi putarine po broju putnika", xlab = "Broj putnika", ylab = "Troškovi putarine")
dev.off()
clearFn()
```
![Troškovi putarine po broju putnika](images/passengerCountTollsAmount.png)
### Analiza zavisnosti atributa passenger_count i total_amount
```{r Analiza zavisnosti atributa passenger_count i total_amount, message=FALSE, warning=FALSE, error=FALSE}
passengerCountTotalAmount <- data %>%
    group_by(passenger_count) %>%
    summarise(min = min(total_amount), max = max(total_amount), avg = mean(total_amount), median = median(total_amount)) %>%
    collect()

kable(passengerCountTotalAmount)
```
```{r Vizuelizacija zavisnosti atributa passenger_count i total_amount, include=FALSE, eval=FALSE, message=FALSE, warning=FALSE, error=FALSE}
pta <- data %>%
    select(passenger_count, total_amount) %>%
    collect()

png("images/passengerCountTotalAmount.png", width = 800, height = 1200)
boxplot(total_amount ~ passenger_count, data = pta, main = "Ukupna cena po broju putnika", xlab = "Broj putnika", ylab = "Ukupna cena")
dev.off()
clearFn()
```
![Ukupna cena po broju putnika](images/passengerCountTotalAmount.png)

### Analiza zavisnosti atributa passenger_count i tip_status
```{r Analiza zavisnosti atributa passenger_count i tip_status, message=FALSE, warning=FALSE, error=FALSE}
passengerCountTipStatus <- data %>%
    group_by(passenger_count, tip_status) %>%
    summarise(count = n()) %>%
    collect()

kable(passengerCountTipStatus)
```
```{r Vizuelizacija zavisnosti atributa passenger_count i tip_status, include=FALSE, eval=FALSE, message=FALSE, warning=FALSE, error=FALSE}
ppc <- data %>%
    select(passenger_count, tip_status) %>%
    collect()

png("images/passengerCountTipStatus.png", width = 800, height = 1200)
mosaicplot(table(ppc), main = "Broj vožnji po broju putnika i načinu plaćanja", xlab = "Broj putnika", ylab = "tip_status", color = c("red", "blue"))
dev.off()
clearFn()
```
![Broj vožnji po broju putnika i načinu plaćanja](images/passengerCountTipStatus.png)
### Analiza zavisnosti atributa trip_distance i payment_type
```{r Analiza zavisnosti atributa trip_distance i payment_type, message=FALSE, warning=FALSE, error=FALSE}
tripDistancePaymentType <- data %>%
    group_by(payment_type) %>%
    summarise(min = min(trip_distance), max = max(trip_distance), avg = mean(trip_distance), median = median(trip_distance)) %>%
    collect()
```
```{r Vizuelizacija zavisnosti atributa trip_distance i payment_type, include=FALSE, eval=FALSE, message=FALSE, warning=FALSE, error=FALSE}
tp <- data %>%
    select(trip_distance, payment_type) %>%
    collect()

png("images/tripDistancePaymentType.png", width = 800, height = 1200)
boxplot(trip_distance ~ payment_type, data = tp, main = "Dužina putovanja po payment_type-u", xlab = "payment_type", ylab = "Dužina putovanja")
dev.off()
```

### Analiza zavisnosti atributa trip_distance i fare_amount
```{r Vizuelizacija zavisnosti atributa trip_distance i fare_amount, include=FALSE, eval=FALSE, message=FALSE, warning=FALSE, error=FALSE}
tfa <- data %>%
    select(trip_distance, fare_amount) %>%
    collect()

png("images/tripDistanceFareAmount.png", width = 800, height = 1200)
plot(tfa, main = "Dužina putovanja po ceni vožnje", xlab = "Dužina putovanja", ylab = "Cena vožnje")
dev.off()
clearFn()
```
![Dužina putovanja po ceni vožnje](images/tripDistanceFareAmount.png)

### Analiza zavisnosti atributa trip_distance i tip_amount
```{r Vizuelizacija zavisnosti atributa trip_distance i tip_amount, include=FALSE, eval=FALSE, message=FALSE, warning=FALSE, error=FALSE}
tta <- data %>%
    select(trip_distance, tip_amount) %>%
    collect()

png("images/tripDistanceTipAmount.png", width = 800, height = 1200)
plot(tta, main = "Dužina putovanja po napojnici", xlab = "Dužina putovanja", ylab = "Napojnica")
dev.off()
clearFn()
```
![Dužina putovanja po napojnici](images/tripDistanceTipAmount.png)

### Analiza zavisnosti atributa trip_distance i tolls_amount
```{r Vizuelizacija zavisnosti atributa trip_distance i tolls_amount, include=FALSE, eval=FALSE, message=FALSE, warning=FALSE, error=FALSE}
tta <- data %>%
    select(trip_distance, tolls_amount) %>%
    collect()

png("images/tripDistanceTollsAmount.png", width = 800, height = 1200)
plot(tta, main = "Dužina putovanja po troškovima putarine", xlab = "Dužina putovanja", ylab = "Troškovi putarine")
dev.off()
clearFn()
```
![Dužina putovanja po troškovima putarine](images/tripDistanceTollsAmount.png)
### Analiza zavisnosti atributa trip_distance i total_amount
```{r Vizuelizacija zavisnosti atributa trip_distance i total_amount, include=FALSE, eval=FALSE, message=FALSE, warning=FALSE, error=FALSE}
tta <- data %>%
    select(trip_distance, total_amount) %>%
    collect()

png("images/tripDistanceTotalAmount.png", width = 800, height = 1200)
plot(tta, main = "Dužina putovanja po ukupnoj ceni", xlab = "Dužina putovanja", ylab = "Ukupna cena")
dev.off()
clearFn()
```
![Dužina putovanja po ukupnoj ceni](images/tripDistanceTotalAmount.png)

### Analiza zavisnosti atributa trip_distance i tip_status
```{r Analiza zavisnosti atributa trip_distance i tip_status, message=FALSE, warning=FALSE, error=FALSE}
tripDistanceTipStatus <- data %>%
    group_by(tip_status) %>%
    summarise(min = min(trip_distance), max = max(trip_distance), avg = mean(trip_distance), median = median(trip_distance)) %>%
    collect()

kable(tripDistanceTipStatus)
```
```{r Vizuelizacija zavisnosti atributa trip_distance i tip_status, include=FALSE, eval=FALSE, message=FALSE, warning=FALSE, error=FALSE}
tpc <- data %>%
    select(trip_distance, tip_status) %>%
    collect()

png("images/tripDistanceTipStatus.png", width = 800, height = 1200)
boxplot(trip_distance ~ tip_status, data = tpc, main = "Dužina putovanja po načinu plaćanja", xlab = "Način plaćanja", ylab = "Dužina putovanja")
dev.off()
clearFn()
```
![Dužina putovanja po načinu plaćanja](images/tripDistanceTipStatus.png)
### Analiza zavisnosti atributa payment_type i fare_amount
```{r Analiza zavisnosti atributa payment_type i fare_amount, message=FALSE, warning=FALSE, error=FALSE}
paymentTypeFareAmount <- data %>%
    group_by(payment_type) %>%
    summarise(min = min(fare_amount), max = max(fare_amount), avg = mean(fare_amount), median = median(fare_amount)) %>%
    collect()

kable(paymentTypeFareAmount)
```
```{r Vizuelizacija zavisnosti atributa payment_type i fare_amount, include=FALSE, eval=FALSE, message=FALSE, warning=FALSE, error=FALSE}
pfa <- data %>%
    select(payment_type, fare_amount) %>%
    collect()

png("images/paymentTypeFareAmount.png", width = 800, height = 1200)
boxplot(fare_amount ~ payment_type, data = pfa, main = "Cena vožnje po payment_type-u", xlab = "payment_type", ylab = "Cena vožnje")
dev.off()
clearFn()
```
![Cena vožnje po payment_type-u](images/paymentTypeFareAmount.png)
### Analiza zavisnosti atributa payment_type i tip_amount
```{r Analiza zavisnosti atributa payment_type i tip_amount, message=FALSE, warning=FALSE, error=FALSE}
paymentTypeTipAmount <- data %>%
    group_by(payment_type) %>%
    summarise(min = min(tip_amount), max = max(tip_amount), avg = mean(tip_amount), median = median(tip_amount)) %>%
    collect()

kable(paymentTypeTipAmount)
```
```{r Vizuelizacija zavisnosti atributa payment_type i tip_amount, include=FALSE, eval=FALSE, message=FALSE, warning=FALSE, error=FALSE}
pta <- data %>%
    select(payment_type, tip_amount) %>%
    collect()

png("images/paymentTypeTipAmount.png", width = 800, height = 1200)
boxplot(tip_amount ~ payment_type, data = pta, main = "Napojnica po payment_type-u", xlab = "payment_type", ylab = "Napojnica")
dev.off()
```
![Napojnica po payment_type-u](images/paymentTypeTipAmount.png)
### Analiza zavisnosti atributa payment_type i tolls_amount
```{r Analiza zavisnosti atributa payment_type i tolls_amount, message=FALSE, warning=FALSE, error=FALSE}
paymentTypeTollsAmount <- data %>%
    group_by(payment_type) %>%
    summarise(min = min(tolls_amount), max = max(tolls_amount), avg = mean(tolls_amount), median = median(tolls_amount)) %>%
    collect()

kable(paymentTypeTollsAmount)
```
```{r Vizuelizacija zavisnosti atributa payment_type i tolls_amount, include=FALSE, eval=FALSE, message=FALSE, warning=FALSE, error=FALSE}
pta <- data %>%
    select(payment_type, tolls_amount) %>%
    collect()

png("images/paymentTypeTollsAmount.png", width = 800, height = 1200)
boxplot(tolls_amount ~ payment_type, data = pta, main = "Troškovi putarine po payment_type-u", xlab = "payment_type", ylab = "Troškovi putarine")
dev.off()
```
![Troškovi putarine po payment_type-u](images/paymentTypeTollsAmount.png)
### Analiza zavisnosti atributa payment_type i total_amount
```{r Analiza zavisnosti atributa payment_type i total_amount, message=FALSE, warning=FALSE, error=FALSE}
paymentTypeTotalAmount <- data %>%
    group_by(payment_type) %>%
    summarise(min = min(total_amount), max = max(total_amount), avg = mean(total_amount), median = median(total_amount)) %>%
    collect()

kable(paymentTypeTotalAmount)
```
```{r Vizuelizacija zavisnosti atributa payment_type i total_amount, include=FALSE, eval=FALSE, message=FALSE, warning=FALSE, error=FALSE}
pta <- data %>%
    select(payment_type, total_amount) %>%
    collect()

png("images/paymentTypeTotalAmount.png", width = 800, height = 1200)
boxplot(total_amount ~ payment_type, data = pta, main = "Ukupna cena po payment_type-u", xlab = "payment_type", ylab = "Ukupna cena")
dev.off()
clearFn()
```
![Ukupna cena po payment_type-u](images/paymentTypeTotalAmount.png)

### Analiza zavisnosti atributa payment_type i tip_status
```{r Analiza zavisnosti atributa payment_type i tip_status, message=FALSE, warning=FALSE, error=FALSE}
paymentTypeTipStatus <- data %>%
    group_by(payment_type, tip_status) %>%
    summarise(count = n()) %>%
    collect()

kable(paymentTypeTipStatus)
```
```{r Vizuelizacija zavisnosti atributa payment_type i tip_status, include=FALSE, eval=FALSE, message=FALSE, warning=FALSE, error=FALSE}
ppc <- data %>%
    select(payment_type, tip_status) %>%
    collect()

png("images/paymentTypeTipStatus.png", width = 800, height = 1200)
mosaicplot(table(ppc), main = "Broj vožnji po payment_type-u i načinu plaćanja", xlab = "payment_type", ylab = "tip_status", color = c("red", "blue"))
dev.off()
clearFn()
```
![Broj vožnji po payment_type-u i načinu plaćanja](images/paymentTypeTipStatus.png)
### Analiza zavisnosti atributa fare_amount i tip_amount
```{r Vizuelizacija zavisnosti atributa fare_amount i tip_amount, include=FALSE, eval=FALSE, message=FALSE, warning=FALSE, error=FALSE}
fta <- data %>%
    select(fare_amount, tip_amount) %>%
    collect()

png("images/fareAmountTipAmount.png", width = 800, height = 1200)
plot(tip_amount ~ fare_amount, data = fta, main = "Napojnica po ceni vožnje", xlab = "Cena vožnje", ylab = "Napojnica")
dev.off()
clearFn()
```
![Napojnica po ceni vožnje](images/fareAmountTipAmount.png)

### Analiza zavisnosti atributa fare_amount i tolls_amount
```{r Vizuelizacija zavisnosti atributa fare_amount i tolls_amount, include=FALSE, eval=FALSE, message=FALSE, warning=FALSE, error=FALSE}
fta <- data %>%
    select(fare_amount, tolls_amount) %>%
    collect()

png("images/fareAmountTollsAmount.png", width = 800, height = 1200)
plot(tolls_amount ~ fare_amount, data = fta, main = "Troškovi putarine po ceni vožnje", xlab = "Cena vožnje", ylab = "Troškovi putarine")
dev.off()
clearFn()
```
![Troškovi putarine po ceni vožnje](images/fareAmountTollsAmount.png)
### Analiza zavisnosti atributa fare_amount i total_amount
```{r Vizuelizacija zavisnosti atributa fare_amount i total_amount, include=FALSE, eval=FALSE, message=FALSE, warning=FALSE, error=FALSE}
fta <- data %>%
    select(fare_amount, total_amount) %>%
    collect()

png("images/fareAmountTotalAmount.png", width = 800, height = 1200)
plot(total_amount ~ fare_amount, data = fta, main = "Ukupna cena po ceni vožnje", xlab = "Cena vožnje", ylab = "Ukupna cena")
dev.off()
clearFn()
```
![Ukupna cena po ceni vožnje](images/fareAmountTotalAmount.png)

### Analiza zavisnosti atributa fare_amount i tip_status
```{r Analiza zavisnosti atributa fare_amount i tip_status, message=FALSE, warning=FALSE, error=FALSE}
fareAmountTipStatus <- data %>%
    group_by(tip_status) %>%
    summarise(min = min(fare_amount), max = max(fare_amount), avg = mean(fare_amount), median = median(fare_amount)) %>%
    collect()

kable(fareAmountTipStatus)
```
```{r Vizuelizacija zavisnosti atributa fare_amount i tip_status, include=FALSE, eval=FALSE, message=FALSE, warning=FALSE, error=FALSE}
fpc <- data %>%
    select(fare_amount, tip_status) %>%
    collect()

png("images/fareAmountTipStatus.png", width = 800, height = 1200)
mosaicplot(table(fpc), main = "Broj vožnji po ceni vožnje i načinu plaćanja", xlab = "fare_amount", ylab = "tip_status", color = c("red", "blue"))
dev.off()
clearFn()
```
![Broj vožnji po ceni vožnje i načinu plaćanja](images/fareAmountTipStatus.png)
### Analiza zavisnosti atributa tip_amount i tolls_amount
```{r Vizuelizacija zavisnosti atributa tip_amount i tolls_amount, include=FALSE, eval=FALSE, message=FALSE, warning=FALSE, error=FALSE}
tta <- data %>%
    select(tip_amount, tolls_amount) %>%
    collect()

png("images/tipAmountTollsAmount.png", width = 800, height = 1200)
plot(tolls_amount ~ tip_amount, data = tta, main = "Troškovi putarine po napojnici", xlab = "Napojnica", ylab = "Troškovi putarine")
dev.off()
clearFn()
```
![Troškovi putarine po napojnici](images/tipAmountTollsAmount.png)
### Analiza zavisnosti atributa tip_amount i total_amount
```{r Vizuelizacija zavisnosti atributa tip_amount i total_amount, include=FALSE, eval=FALSE, message=FALSE, warning=FALSE, error=FALSE}
tta <- data %>%
    select(tip_amount, total_amount) %>%
    collect()

png("images/tipAmountTotalAmount.png", width = 800, height = 1200)
plot(total_amount ~ tip_amount, data = tta, main = "Ukupna cena po napojnici", xlab = "Napojnica", ylab = "Ukupna cena")
dev.off()
clearFn()
```
![Ukupna cena po napojnici](images/tipAmountTotalAmount.png)
### Analiza zavisnosti atributa tip_amount i tip_status
```{r Analiza zavisnosti atributa tip_amount i tip_status, message=FALSE, warning=FALSE, error=FALSE}
tipAmountTipStatus <- data %>%
    group_by(tip_status) %>%
    summarise(min = min(tip_amount), max = max(tip_amount), avg = mean(tip_amount), median = median(tip_amount)) %>%
    collect()

kable(tipAmountTipStatus)
```
```{r Vizuelizacija zavisnosti atributa tip_amount i tip_status, include=FALSE, eval=FALSE, message=FALSE, warning=FALSE, error=FALSE}
tpc <- data %>%
    select(tip_amount, tip_status) %>%
    collect()

png("images/tipAmountTipStatus.png", width = 800, height = 1200)
boxplot(tip_amount ~ tip_status, data = tpc, main = "Napojnica po načinu plaćanja", xlab = "Način plaćanja", ylab = "Napojnica")
dev.off()
clearFn()
```
![Napojnica po načinu plaćanja](images/tipAmountTipStatus.png)
### Analiza zavisnosti atributa tolls_amount i total_amount
```{r Vizuelizacija zavisnosti atributa tolls_amount i total_amount, include=FALSE, eval=FALSE, message=FALSE, warning=FALSE, error=FALSE}
tta <- data %>%
    select(tolls_amount, total_amount) %>%
    collect()

png("images/tollsAmountTotalAmount.png", width = 800, height = 1200)
plot(total_amount ~ tolls_amount, data = tta, main = "Ukupna cena po troškovima putarine", xlab = "Troškovi putarine", ylab = "Ukupna cena")
dev.off()
clearFn()
```
![Ukupna cena po troškovima putarine](images/tollsAmountTotalAmount.png)

### Analiza zavisnosti atributa tolls_amount i tip_status
```{r Analiza zavisnosti atributa tolls_amount i tip_status, message=FALSE, warning=FALSE, error=FALSE}
tollsAmountTipStatus <- data %>%
    group_by(tip_status) %>%
    summarise(min = min(tolls_amount), max = max(tolls_amount), avg = mean(tolls_amount), median = median(tolls_amount)) %>%
    collect()

kable(tollsAmountTipStatus)
```
```{r Vizuelizacija zavisnosti atributa tolls_amount i tip_status, include=FALSE, eval=FALSE, message=FALSE, warning=FALSE, error=FALSE}
tpc <- data %>%
    select(tolls_amount, tip_status) %>%
    collect()

png("images/tollsAmountTipStatus.png", width = 800, height = 1200)
boxplot(tolls_amount ~ tip_status, data = tpc, main = "Troškovi putarine po načinu plaćanja", xlab = "Način plaćanja", ylab = "Troškovi putarine")
dev.off()
clearFn()
```
![Troškovi putarine po načinu plaćanja](images/tollsAmountTipStatus.png)
### Analiza zavisnosti atributa total_amount i tip_status
```{r Vizuelizacija zavisnosti atributa total_amount i tip_status, include=FALSE, eval=FALSE, message=FALSE, warning=FALSE, error=FALSE}
tpc <- data %>%
    select(total_amount, tip_status) %>%
    collect()

png("images/totalAmountTipStatus.png", width = 800, height = 1200)
boxplot(total_amount ~ tip_status, data = tpc, main = "Ukupna cena po načinu plaćanja", xlab = "Način plaćanja", ylab = "Ukupna cena")
dev.off()
clearFn()
```
![Ukupna cena po načinu plaćanja](images/totalAmountTipStatus.png)

# Klasifikacija
## Priprema podataka
```{r Priprema podataka, message=FALSE, warning=FALSE, error=FALSE}
data_splitted <- sdf_random_split(data, training=0.9, test = 0.1, seed = 1)
```
## Klasifikacioni modeli
```{r Klasifikacioni predictori, message=FALSE, warning=FALSE, error=FALSE}
predictor <- tip_status ~ trip_distance + fare_amount + tolls_amount + total_amount + passenger_count
```
## Logistička regresija
```{r Logistička regresija, message=FALSE, warning=FALSE, error=FALSE}
logistic_models <- list()
logistic_evals <- list()

for(i in 1:length(models)){
    logistic_models[[i]] <- ml_logistic_regression(data_splitted$train, models[[i]])
    logistic_evals[[i]] <- ml_evaluate(logistic_models[[i]], data_splitted$test)

    print(paste("Model number", i))
    print(paste("Accuracy", logistic_evals[[i]]$accuracy()))
    print(paste("Precision", logistic_evals[[i]]$precision()))
}

# Validacija modela
vfolds <- sdf_random_split(
    model_data, 
    weights = purrr::set_names(rep(0.25, 4), paste0("k", 1:4)),
    seed = 1
)

logistic_errors <- list()
for(j in 1:4){
    train <- do.call(rbind, vfolds[-j])
    test <- vfolds[[j]]
    model <- ml_logistic_regression(train, models[[1]])
    eval <- ml_evaluate(model, test)
    logistic_errors[[j]] <- 1 - eval$accuracy()
}
```
## Mašina potpornih vektora
```{r Mašina potpornih vektora, message=FALSE, warning=FALSE, error=FALSE}
svm_models <- list()
svm_evaluations <- list()

for(i in 1:models_num){
    svm_models[[i]] <- ml_linear_svc(data_splitted$train, models[[i]])
    svm_evaluations[[i]] <- ml_evaluate(svm_models[[i]], data_splitted$test)
}
```
## Stablo odlučivanja
```{r Stablo odlučivanja, message=FALSE, warning=FALSE, error=FALSE}
dt_models <- list()
dt_evaluations <- list()

for(i in 1:models_num){
    dt_models[[i]] <- ml_decision_tree_classifier(data_splitted$train, models[[i]])
    dt_evaluations[[i]] <- ml_evaluate(dt_models[[i]], data_splitted$test)
}
```